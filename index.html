<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>嘖嘖平台的數據分析</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #007bff;
            color: white;
            text-align: center;
            padding: 20px 0;
        }

        .container {
            padding: 20px;
        }

        .dropdown {
            margin: 20px 0;
            text-align: center;
        }

        .chart-container {
            display: none;
            justify-content: center;
        }

        canvas {
            max-width: 80%;
            height: 80px;
        }

        .visible {
            display: flex;
        }

        #searchContainer {
            text-align: center;
            margin: 20px 0;
        }

        #results {
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>
    <header>
        <h1>嘖嘖平台的數據分析</h1>
    </header>
    <div id="searchContainer" class="container">
        <input type="text" id="searchInput" placeholder="Search CSV data...">
        <button id="searchButton">Search</button>
        <div id="results"></div>
    </div>
    <div class="container">
        <div class="dropdown">
            <label for="chartSelect">請選擇你要查詢的圖表：</label>
            <select id="chartSelect">
                <option value="">--請選擇--</option>
                <option value="targetAmountChart">每種產品平均目標金額</option>
                <option value="crowdfundingPercentageChart">每種產品平均募資百分比</option>
                <option value="investorNumberChart">每種產品平均投資人數</option>
                <option value="successRateChart">每種產品集資成功比例</option>
                <option value="totalTargetAmountPieChart">各類別目標金額占比</option>
                <option value="productCountPieChart">各類別產品數量占比</option>
            </select>
        </div>
        <div id="chartContainers">
            <div id="targetAmountChartContainer" class="chart-container">
                <canvas id="targetAmountChart"></canvas>
            </div>
            <div id="crowdfundingPercentageChartContainer" class="chart-container">
                <canvas id="crowdfundingPercentageChart"></canvas>
            </div>
            <div id="investorNumberChartContainer" class="chart-container">
                <canvas id="investorNumberChart"></canvas>
            </div>
            <div id="successRateChartContainer" class="chart-container">
                <canvas id="successRateChart"></canvas>
            </div>
            <div id="totalTargetAmountPieChartContainer" class="chart-container">
                <canvas id="totalTargetAmountPieChart"></canvas>
            </div>
            <div id="productCountPieChartContainer" class="chart-container">
                <canvas id="productCountPieChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var chartSelect = document.getElementById('chartSelect');
            var chartContainers = document.getElementById('chartContainers').children;

            chartSelect.addEventListener('change', function () {
                for (var i = 0; i < chartContainers.length; i++) {
                    chartContainers[i].classList.remove('visible');
                }
                if (this.value) {
                    document.getElementById(this.value + 'Container').classList.add('visible');
                }
            });

            // Initialize charts
            var labels = ['出版', '地方創生', '挺好店', '攝影', '教育', '新春賀喜', '時尚', '社會', '科技', '空間', '藝術', '表演', '設計', '遊戲', '電影動畫', '音樂', '飲食'];
            var targetAmountData = [855952.08, 344861.77, 220640.43, 1063000.72, 704304.99, 125158.0, 744667.86, 641706.56, 3291086.49, 1259325.67, 308509.14, 122232.18, 1463995.61, 941955.45, 232125.05, 244477.1, 716272.91];
            var crowdfundingPercentageData = [2510.58, 265.77, 801.25, 1079.84, 726.18, 929.0, 1005.03, 192.21, 3199.54, 1259.98, 364.82, 161.74, 1561.79, 2494.91, 177.81, 164.03, 1652.85];
            var investorNumberData = [585.75, 146.28, 100.80, 432.06, 251.44, 104.53, 266.60, 366.26, 660.54, 256.31, 175.04, 68.77, 621.64, 474.45, 151.37, 142.53, 268.06];
            var successRateData = [0.77, 0.72, 0.84, 0.77, 0.74, 0.79, 0.79, 0.78, 0.82, 0.67, 0.75, 0.74, 0.77, 0.77, 0.69, 0.75, 0.79];

            var totalTargetAmountLabels = ['出版', '地方創生', '挺好店', '攝影', '教育', '新春賀喜', '時尚', '社會', '科技', '空間', '藝術', '表演', '設計', '遊戲', '電影動畫', '音樂', '飲食'];
            var totalTargetAmountData = [
                1286495982.0, 178983261.0, 110540856.0, 204096138.0, 635987409.0, 16145382.0, 1154979846.0,
                839352177.0, 16764794592.0, 204010758.0, 161041770.0, 48770640.0, 10189409412.0, 1048396419.0,
                127436652.0, 136418220.0, 1177552662.0
            ];

            var productCountData = [1503, 519, 501, 192, 903, 129, 1551, 1308, 5094, 162, 522, 399, 6960, 1113, 549, 558, 1644];

            createBarChart('targetAmountChart', '平均目標金額', labels, targetAmountData);
            createBarChart('crowdfundingPercentageChart', '平均募資百分比', labels, crowdfundingPercentageData);
            createBarChart('investorNumberChart', '平均投資人數', labels, investorNumberData);
            createBarChart('successRateChart', '集資成功比例', labels, successRateData);
            createPieChart('totalTargetAmountPieChart', '各類別目標金額占比', totalTargetAmountLabels, totalTargetAmountData);
            createPieChart('productCountPieChart', '各類別產品數量占比', totalTargetAmountLabels, productCountData);

            // CSV search
            document.getElementById('searchButton').addEventListener('click', function () {
                const query = document.getElementById('searchInput').value.toLowerCase();
                fetch('C:\Users\User\Desktop\大三下\網路爬蟲\FINAL\merged.csv')  // Corrected path to the CSV file
                    .then(response => response.text())
                    .then(csvText => {
                        const lines = csvText.split('\n');
                        const headers = lines[0].split(',');
                        const results = lines.slice(1).filter(line => line.toLowerCase().includes(query));
                        displayResults(results, headers);
                    });
            });

            function displayResults(results, headers) {
                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = '';
                if (results.length === 0) {
                    resultsContainer.textContent = 'No results found.';
                    return;
                }
                const table = document.createElement('table');
                const thead = document.createElement('thead');
                const tbody = document.createElement('tbody');

                const headerRow = document.createElement('tr');
                headers.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                results.forEach(result => {
                    const row = document.createElement('tr');
                    const cells = result.split(',');
                    cells.forEach(cell => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        row.appendChild(td);
                    });
                    tbody.appendChild(row);
                });

                table.appendChild(thead);
                table.appendChild(tbody);
                resultsContainer.appendChild(table);
            }

            function createBarChart(chartId, label, labels, data) {
                new Chart(document.getElementById(chartId), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: label,
                            data: data,
                            backgroundColor: 'rgba(0, 123, 255, 0.5)',
                            borderColor: 'rgba(0, 123, 255, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            function createPieChart(chartId, label, labels, data) {
                new Chart(document.getElementById(chartId), {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: label,
                            data: data,
                            backgroundColor: labels.map(() => getRandomColor())
                        }]
                    },
                    options: {
                        responsive: true
                    }
                });
            }

            function getRandomColor() {
                const letters = '0123456789ABCDEF';
                let color = '#';
                for (let i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }
        });
    </script>
</body>
</html>
